<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Math Problems</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    * {
      box-sizing: border-box;
      font-size: 1.5rem;
    }

    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    input[type=number] {
      -moz-appearance: textfield;
    }
  </style>
</head>

<body style="margin: 0; background: #444; transition: all .6s;">
  <div
    style="margin: 15% auto; max-width: 100%; text-align: center; padding: .5rem; background: #fff; transition: all .1s;"
    id="bar">
    <span id="first">0</span>
    <span id="operation">+</span>
    <span id="second">0</span>
    =
    <input type="number" id="answer" maxlength="4" style="width:5rem;" />
    <div>
      <input type="submit" value="GO!" id="next"
        style="padding: .5rem 1rem; margin-top: .5rem; font-weight: bold; border-radius: 1rem; cursor: pointer;" />
    </div>
  </div>

  <script>
    const firstElement = document.getElementById('first');
    const secondElement = document.getElementById('second');
    const operationElement = document.getElementById('operation');
    const answerElement = document.getElementById('answer');
    const nextElement = document.getElementById('next');
    const barElement = document.getElementById('bar');
    const operations = [minus, plus];
    const colors = '1234567890abcdef'.split('');
    const problem = {};
    let frameCount = 0;

    function rng(l, h) {
      return Math.floor(Math.random() * (h - l + 1)) + l;
    }

    function plus(first, second) {
      return (!first) ? '+' : first + second;
    }

    function minus(first, second) {
      return (!first) ? '-' : first - second;
    }

    function next() {
      const input = parseInt(answerElement.value);
      if (input === problem.answer) {
        barElement.style.backgroundColor = '#FFF';
        newProblem();
      } else {
        barElement.style.backgroundColor = '#FF8B8B';
        visualizeError();
      }
    }

    function visualizeError() {
      if (frameCount < 36) {
        answerElement.style.margin = `0 ${Math.sin(frameCount/1.8)*2.4}px`;
        frameCount++;
        requestAnimationFrame(visualizeError);
      } else {
        answerElement.style.margin = '0';
        frameCount = 0;
        cancelAnimationFrame(visualizeError);
      }
    }

    function updateUI() {
      firstElement.innerHTML = problem.first;
      secondElement.innerHTML = problem.second;
      operationElement.innerHTML = problem.operation();
      answerElement.value = '';
      let newBGColors = '';
      for (i = 0; i < 6; i++) {
        newBGColors += colors[Math.floor(Math.random() * colors.length)];
      }
      document.body.style.backgroundColor = `#${newBGColors}`;
    }

    function newProblem() {
      // set numbers (larger number first as we don't want negative answers)(0 is fine)
      const first = rng(1, 15);
      const second = rng(0, 9);
      if (first > second) {
        problem.first = first;
        problem.second = second;
      } else {
        problem.first = second;
        problem.second = first;
      }
      problem.operation = operations[rng(0, 1)];
      problem.answer = problem.operation(
        problem.first,
        problem.second
      );
      updateUI()
    }

    nextElement.addEventListener('click', next);
    answer.addEventListener('keyup', e => {
      if (e.keyCode === 13) { // 13 = 'enter' key
        next();
      } else {
        return e;
      }
    });
    newProblem();
  </script>
</body>

</html>
